# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SQLAlchemy –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
sqlalchemy.exc.InvalidRequestError: Instance '<Media at 0x...>' has been deleted. 
Use the make_transient() function to send this object back to the transient state.
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

1. **Frontend** –æ—Ç–ø—Ä–∞–≤–ª—è–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–π API `/categories/{id}/products/{id}` –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
2. **Backend** –ø—ã—Ç–∞–ª—Å—è –¥–æ–±–∞–≤–∏—Ç—å —É–∂–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã Media –≤ session
3. **SQLAlchemy** –Ω–µ –º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –∏ –Ω–æ–≤—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª:** `frontend/src/components/admin/ProductManager.jsx`

- **–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞:** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–π API
- **–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API `/products/{id}/images`
- **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞:** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–π API

```javascript
if (editingProduct) {
  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–¥—É–∫—Ç –ë–ï–ó –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  await dispatch(updateProduct({...}));
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API
  if (formData.images && formData.images.length > 0) {
    const imageFormData = new FormData();
    formData.images.forEach((image) => {
      imageFormData.append('images', image);
    });
    
    await fetch(`http://localhost:8000/products/${editingProduct.id}/images`, {
      method: 'POST',
      body: imageFormData,
    });
  }
}
```

### 2. Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª:** `backend/app/crud/category.py`

- **–£–±—Ä–∞–ª** `session.add(db_product)` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- **–ü—Ä–∏—á–∏–Ω–∞:** –æ–±—ä–µ–∫—Ç —É–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è session'–æ–º, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç

```python
# –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
if update_data.model_dump(exclude_unset=True):
    for field, value in update_data.model_dump(exclude_unset=True).items():
        setattr(db_product, field, value)
    # –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º db_product –≤ session, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —É–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

1. **–û—à–∏–±–∫–∞ SQLAlchemy –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - –±–æ–ª—å—à–µ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å Media –æ–±—ä–µ–∫—Ç–∞–º–∏
2. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è** —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
3. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç** –∫–∞–∫ —Ä–∞–Ω—å—à–µ —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–π API
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** –æ —Ç–æ–º, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–±–∞–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

## üìã –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É + –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `/categories/{id}/products/` (—Å—Ç–∞—Ä—ã–π API)
3. Backend —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∞ + –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `/categories/{id}/products/{id}` (—Å—Ç–∞—Ä—ã–π API)
3. –ù–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `/products/{id}/images` (–Ω–æ–≤—ã–π API)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–±–∞–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç** —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç** —Å –Ω–æ–≤—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–î–∞—Ç–∞:** –û–∫—Ç—è–±—Ä—å 2025
