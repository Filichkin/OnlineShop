# –ú–ò–ì–†–ê–¶–ò–Ø JWT: localStorage ‚Üí httpOnly Cookies + CSRF

## –†–ï–ó–Æ–ú–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **JWT —Ç–æ–∫–µ–Ω—ã –≤ httpOnly cookies** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
2. **CSRF –∑–∞—â–∏—Ç–∞** –¥–ª—è –≤—Å–µ—Ö state-changing –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ù–æ–≤—ã–µ endpoints**: GET /csrf-token, POST /auth/logout
4. **Cookie-based authentication** —á–µ—Ä–µ–∑ CookieTransport
5. **–°–æ—Ö—Ä–∞–Ω—ë–Ω –º–µ—Ö–∞–Ω–∏–∑–º session_id** - merge –∫–æ—Ä–∑–∏–Ω—ã/–∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
/backend/app/core/csrf.py              - CSRF token –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
/backend/app/core/cookie_transport.py  - JWT transport —á–µ—Ä–µ–∑ cookies
```

### üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
/backend/app/core/config.py            - –¥–æ–±–∞–≤–ª–µ–Ω—ã secure_cookies, access_token_expire_minutes
/backend/app/core/auth.py              - login_user —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç JWT –∏ CSRF –≤ cookies
/backend/app/core/user.py              - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CookieTransport –≤–º–µ—Å—Ç–æ BearerTransport
/backend/app/api/endpoints/user.py     - register/logout + CSRF –∑–∞—â–∏—Ç–∞
/backend/app/api/endpoints/order.py    - CSRF –∑–∞—â–∏—Ç–∞ –Ω–∞ create/cancel/update
/backend/app/api/endpoints/cart.py     - CSRF –∑–∞—â–∏—Ç–∞ –Ω–∞ –≤—Å–µ POST/PATCH/DELETE
```

### üîê –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoints

- **Orders**: POST /, DELETE /{id}, PATCH /admin/{id}/status
- **Users**: PATCH /me, PATCH /admin/{id}
- **Cart**: POST /items, PATCH /items/{id}, DELETE /items/{id}, DELETE /

### üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ (—Å–º. SECURITY_MIGRATION.txt —Ä–∞–∑–¥–µ–ª 8)
2. –£–¥–∞–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å localStorage
3. –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω –≤ headers –¥–ª—è POST/PUT/PATCH/DELETE
4. –î–æ–±–∞–≤–∏—Ç—å credentials: 'include' –≤–æ –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã
5. –í production —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SECURE_COOKIES=true –≤ .env

### ‚ö†Ô∏è –í–ê–ñ–ù–û

- Login/Register response –∏–∑–º–µ–Ω–∏–ª—Å—è - –±–æ–ª—å—à–µ –ù–ï–¢ access_token –≤ JSON
- –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å X-CSRF-Token header –¥–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å credentials: 'include'

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: SECURITY_MIGRATION.txt

